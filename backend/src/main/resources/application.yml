spring:
  application:
    name: predata-backend

  datasource:
    url: jdbc:mariadb://localhost:3306/predata?rewriteBatchedStatements=true&useBulkStmts=true
    username: ${DB_USERNAME:mac}
    password: ${DB_PASSWORD:predata}
    driver-class-name: org.mariadb.jdbc.Driver
    hikari:
      maximum-pool-size: 50           # 동시 접속 300명 대응 (기본값 10 → 50)
      minimum-idle: 10                # 유휴 커넥션 최소 10개 유지
      connection-timeout: 5000        # 커넥션 획득 타임아웃 5초
      idle-timeout: 300000            # 유휴 커넥션 제거 시간 5분
      max-lifetime: 600000            # 커넥션 최대 생명 주기 10분

  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
    baseline-version: 0
    validate-on-migrate: true
    out-of-order: false

  jpa:
    hibernate:
      ddl-auto: none  # Flyway가 스키마 관리하므로 Hibernate 스키마 관리 비활성화
    show-sql: false
    properties:
      hibernate:
        format_sql: false
        dialect: org.hibernate.dialect.MariaDBDialect
        jdbc:
          batch_size: 50
        order_inserts: true
        order_updates: true

  transaction:
    default-timeout: 5                # 기본 트랜잭션 타임아웃 5초 (데드락 방지)

  mail:
    host: ${MAIL_HOST:smtp.gmail.com}
    port: ${MAIL_PORT:587}
    username: ${MAIL_USERNAME:}
    password: ${MAIL_PASSWORD:}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
            required: true

  security:
    oauth2:
      client:
        registration:
          google:
            client-id: ${GOOGLE_CLIENT_ID:dummy}
            client-secret: ${GOOGLE_CLIENT_SECRET:dummy}
            scope:
              - email
              - profile
            redirect-uri: "https://api.predata.io/login/oauth2/code/google"
        provider:
          google:
            authorization-uri: https://accounts.google.com/o/oauth2/v2/auth
            token-uri: https://oauth2.googleapis.com/token
            user-info-uri: https://www.googleapis.com/oauth2/v3/userinfo
            user-name-attribute: sub

server:
  port: 8080
  servlet:
    session:
      timeout: 30m  # OAuth2 state 세션 타임아웃 (30분)

jwt:
  secret: ${JWT_SECRET:your-secret-key-must-be-at-least-256-bits-long-for-HS256-algorithm-to-work-properly}
  expiration-ms: ${JWT_EXPIRATION:86400000}  # 24 hours in milliseconds

auth:
  demo-mode: ${AUTH_DEMO_MODE:true}  # true: 이메일 발송 안함(로그만), false: 실제 이메일 발송

google:
  oauth:
    client-id: ${GOOGLE_CLIENT_ID:dummy}
    client-secret: ${GOOGLE_CLIENT_SECRET:dummy}

sports:
  api:
    key: ${SPORTS_API_KEY:}
    enabled: ${SPORTS_API_ENABLED:false}
    rate-limit-delay-ms: ${SPORTS_RATE_LIMIT_MS:500}
    fetch-window-days: ${SPORTS_FETCH_WINDOW:7}
  football-data:
    api-key: ${FOOTBALL_DATA_API_KEY:}
    base-url: ${FOOTBALL_DATA_BASE_URL:https://api.football-data.org/v4}
    fetch-window-days: ${FOOTBALL_DATA_FETCH_WINDOW:7}
  scheduler:
    sync-cron: "0 0 6 * * *" # 수동 동기화/레거시 호환용
    auto-sync-check-cron: "0 0 * * * *" # 1시간마다 정책 체크
    sync-hours: "0,2,4,6,8,10,12,14,16,18" # 경기 있는 날 하루 10회
    no-match-sync-hour: 12 # 경기 없는 날 12시에 1회
    zone: "UTC"
    live-poll-interval-ms: 60000
    phase-check-interval-ms: 300000
  legacy-scheduler:
    enabled: false

anthropic:
  api:
    key: ${ANTHROPIC_API_KEY:}

openai:
  api:
    key: ${OPENAI_API_KEY:}
    model: ${OPENAI_MODEL:gpt-4o-mini}
    base-url: ${OPENAI_BASE_URL:https://api.openai.com/v1/chat/completions}

# Polygon USDC 결제 시스템
polygon:
  rpc-url: ${POLYGON_RPC_URL:https://rpc-amoy.polygon.technology}
  receiver-wallet: ${RECEIVER_WALLET:0xd65834BDfaeEA4539a5cEa715deebD7A899C9dAD}
  usdc-contract: ${USDC_CONTRACT_ADDRESS:0x8D298060d7D9C4C5Eb45c96FD61ecCEEDE020B05}
  chain-id: ${POLYGON_CHAIN_ID:80002}  # Amoy=80002, Mainnet=137
  sender-private-key: ${SENDER_PRIVATE_KEY:1e8b9a5b19e2fd5b1e25a9b14a3e960e7a2bf9d092ede09d2509a845932549ad}  # 출금용 서버 지갑 프라이빗 키

logging:
  level:
    com.predata.backend: DEBUG
    org.hibernate.SQL: WARN

# 리스크 관리 설정
app:
  rate-limit:
    dev-mode: ${RATE_LIMIT_DEV_MODE:true}  # 개발 기본값 true (로컬/데모 환경), prod 배포 시 환경변수로 false 설정

  risk:
    max-position-per-market: 1000  # 시장당 최대 포지션 크기
    max-order-value: 500           # 단일 주문 최대 금액
    circuit-breaker:
      trade-count-threshold: 100   # 트리거되는 거래 횟수
      time-window-seconds: 60      # 시간 윈도우 (초)
      cooldown-seconds: 30         # 쿨다운 기간 (초)

  # 투표 시스템 설정
  voting:
    daily-limit: 5  # 일일 투표 한도 (UTC 00:00 기준)
    idempotency-cleanup-interval-ms: 3600000  # 만료 idempotency key 정리 주기(1시간)

  # 리워드 시스템 설정
  reward:
    level-weights:
      1: 1.0
      2: 1.2
      3: 1.5
      4: 2.0
      5: 3.0
    min-payout: 0.01  # 최소 지급 금액 (0.01 미만 절사)

  # 시빌 공격 완화 설정
  sybil:
    min-account-age-days: 3  # 보상 대상 최소 계정 생성 후 경과 일수
    min-vote-history: 3      # 보상 대상 최소 투표 이력 (다른 질문)

  questiongen:
    enabled: ${QUESTIONGEN_ENABLED:false}
    daily-cron: ${QUESTIONGEN_DAILY_CRON:0 5 0 * * *}
    legacy-interval-enabled: ${QUESTIONGEN_LEGACY_INTERVAL_ENABLED:false}
    trends-url: ${QUESTIONGEN_TRENDS_URL:https://trends.google.com/trends/api/dailytrends}

  # 마켓메이커 설정
  market-maker:
    member-id: ${MARKET_MAKER_MEMBER_ID:1}  # 마켓메이커 계정 ID (DB에서 생성 필요)
