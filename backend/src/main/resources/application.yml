spring:
  application:
    name: predata-backend

  datasource:
    url: jdbc:mariadb://localhost:3306/predata?rewriteBatchedStatements=true&useBulkStmts=true
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:}
    driver-class-name: org.mariadb.jdbc.Driver
    hikari:
      maximum-pool-size: 100
      minimum-idle: 20
      connection-timeout: 5000
      idle-timeout: 300000
      max-lifetime: 600000

  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
    baseline-version: -1
    validate-on-migrate: true
    out-of-order: false

  jpa:
    hibernate:
      ddl-auto: none
    show-sql: false
    properties:
      hibernate:
        format_sql: false
        dialect: org.hibernate.dialect.MariaDBDialect
        jdbc:
          batch_size: 50
        order_inserts: true
        order_updates: true

  transaction:
    default-timeout: 10

  mail:
    host: smtp.gmail.com
    port: 587
    username: ${MAIL_USERNAME:}
    password: ${MAIL_PASSWORD:}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
            required: true

  security:
    oauth2:
      client:
        registration:
          google:
            client-id: ${GOOGLE_CLIENT_ID:}
            client-secret: ${GOOGLE_CLIENT_SECRET:}
            scope:
              - email
              - profile
            redirect-uri: "{baseUrl}/login/oauth2/code/{registrationId}"
        provider:
          google:
            authorization-uri: https://accounts.google.com/o/oauth2/v2/auth
            token-uri: https://oauth2.googleapis.com/token
            user-info-uri: https://www.googleapis.com/oauth2/v3/userinfo
            user-name-attribute: sub

server:
  port: 8080
  forward-headers-strategy: framework
  servlet:
    session:
      timeout: 30m
  tomcat:
    threads:
      max: 400
      min-spare: 50
    max-connections: 1000
    accept-count: 200

jwt:
  secrets:
    - ${JWT_SECRET:}
    - ${JWT_SECRET_ROTATION:}
  expiration-ms: ${JWT_EXPIRATION:86400000}

auth:
  demo-mode: ${AUTH_DEMO_MODE:false}

google:
  oauth:
    client-id: ${GOOGLE_CLIENT_ID:}
    client-secret: ${GOOGLE_CLIENT_SECRET:}

sports:
  api:
    key: ${SPORTS_API_KEY:}
    enabled: ${SPORTS_API_ENABLED:false}
    rate-limit-delay-ms: ${SPORTS_RATE_LIMIT_MS:500}
    fetch-window-days: ${SPORTS_FETCH_WINDOW:7}
  football-data:
    api-key: ${FOOTBALL_DATA_API_KEY:}
    base-url: ${FOOTBALL_DATA_BASE_URL:https://api.football-data.org/v4}
    fetch-window-days: ${FOOTBALL_DATA_FETCH_WINDOW:7}
  scheduler:
    sync-cron: "0 0 6 * * *"
    auto-sync-check-cron: "0 0 * * * *"
    sync-hours: "0,2,4,6,8,10,12,14,16,18"
    no-match-sync-hour: 12
    zone: "UTC"
    live-poll-interval-ms: 60000
    phase-check-interval-ms: 300000
  legacy-scheduler:
    enabled: false

anthropic:
  api:
    key: ${ANTHROPIC_API_KEY:}

gemini:
  api:
    key: ${GEMINI_API_KEY:}
    model: ${GEMINI_MODEL:gemini-1.5-flash}

openai:
  api:
    key: ${OPENAI_API_KEY:}
    model: ${OPENAI_MODEL:gpt-4o-mini}
    base-url: ${OPENAI_BASE_URL:https://api.openai.com/v1/chat/completions}

polygon:
  rpc-url: ${POLYGON_RPC_URL:https://rpc-amoy.polygon.technology}
  receiver-wallet: ${RECEIVER_WALLET:0xd65834BDfaeEA4539a5cEa715deebD7A899C9dAD}
  usdc-contract: ${USDC_CONTRACT_ADDRESS:0x8D298060d7D9C4C5Eb45c96FD61ecCEEDE020B05}
  chain-id: ${POLYGON_CHAIN_ID:80002}
  sender-private-key: ${SENDER_PRIVATE_KEY:}

logging:
  level:
    com.predata.backend: DEBUG
    org.hibernate.SQL: WARN

management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: when-authorized

app:
  frontend-url: https://predata.io

  rate-limit:
    dev-mode: ${RATE_LIMIT_DEV_MODE:true}

  risk:
    max-position-per-market: 1000
    max-order-value: 500
    circuit-breaker:
      trade-count-threshold: 100
      time-window-seconds: 60
      cooldown-seconds: 30

  voting:
    daily-limit: 5
    idempotency-cleanup-interval-ms: 3600000

  reward:
    level-weights:
      1: 1.0
      2: 1.2
      3: 1.5
      4: 2.0
      5: 3.0
    min-payout: 0.01

  sybil:
    min-account-age-days: 3
    min-vote-history: 3

  questiongen:
    enabled: ${QUESTIONGEN_ENABLED:true}
    daily-cron: ${QUESTIONGEN_DAILY_CRON:0 5 0 * * *}
    daily-batch-enabled: ${QUESTIONGEN_BATCH_ENABLED:false}
    daily-trend-enabled: ${QUESTIONGEN_TREND_ENABLED:true}
    daily-trend-cron: ${QUESTIONGEN_TREND_CRON:0 0 9 * * *}
    daily-trend-geo: ${QUESTIONGEN_TREND_GEO:US}
    max-generation-attempts: ${QUESTIONGEN_MAX_GENERATION_ATTEMPTS:3}
    legacy-interval-enabled: ${QUESTIONGEN_LEGACY_INTERVAL_ENABLED:false}
    trends-url: ${QUESTIONGEN_TRENDS_URL:https://trends.google.com/trends/api/dailytrends}
    trends-force-refresh-on-generate: ${QUESTIONGEN_TRENDS_FORCE_REFRESH_ON_GENERATE:true}
    trends-freshness-minutes: ${QUESTIONGEN_TRENDS_FRESHNESS_MINUTES:30}
    realtime-trends-enabled: ${QUESTIONGEN_REALTIME_TRENDS_ENABLED:true}
    realtime-trends-cron: ${QUESTIONGEN_REALTIME_TRENDS_CRON:0 */15 * * * *}
    realtime-trends-max-signals: ${QUESTIONGEN_REALTIME_TRENDS_MAX_SIGNALS:20}
    realtime-trends-freshness-minutes: ${QUESTIONGEN_REALTIME_TRENDS_FRESHNESS_MINUTES:30}
    sanity:
      kospi-current: ${QUESTIONGEN_SANITY_KOSPI_CURRENT:7000}
      nasdaq-current: ${QUESTIONGEN_SANITY_NASDAQ_CURRENT:22000}
      bitcoin-current: ${QUESTIONGEN_SANITY_BITCOIN_CURRENT:100000}

  auto-resolution:
    enabled: ${AUTO_RESOLUTION_ENABLED:true}
    check-interval-ms: 300000

  market-maker:
    member-id: ${MARKET_MAKER_MEMBER_ID:1}
